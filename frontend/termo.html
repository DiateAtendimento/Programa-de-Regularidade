<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Termo de Adesão ao Programa de Regularidade Previdenciária</title>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=block" rel="stylesheet">
  <link href="https://fonts.cdnfonts.com/css/rawline" rel="stylesheet">
  <link rel="stylesheet" href="termo.css" />
</head>
<body>
  <main id="pdf-root" class="term-wrap">
    <header class="page-head">
      <div class="logos-wrap" aria-label="Identidade visual MPS">
        <img class="logo-sec" src="imagens/logo-secretaria-complementar.svg"
            alt="Secretaria de Regimes Próprios e Complementar" />
        <img class="logo-mps" src="imagens/logo-termo-drpps.svg"
            alt="Ministério da Previdência Social - MPS" />
        <div class="logo-rule" aria-hidden="true"></div>
      </div>

      <!-- Título visível logo abaixo da linha das logos -->
      <h1 id="term-title" class="term-title">
        FORMULÁRIO PARA GERAÇÃO DO TERMO DE ADESÃO AO PROGRAMA DE REGULARIDADE PREVIDENCIÁRIA
      </h1>
    </header>

    <!-- 1. IDENTIFICAÇÃO DO ENTE FEDERATIVO -->
    <section class="term-section">
      <h2>1. IDENTIFICAÇÃO DO ENTE FEDERATIVO</h2>

      <p><strong>1.1 Esfera de Governo</strong></p>
      <ul>
        <li><strong>1.1.1 RPPS Municipal</strong> &nbsp;/&nbsp; <strong>1.1.2 Estadual/Distrital</strong></li>
        <li><strong>Selecionado:</strong> <span data-k="esfera"></span></li>
      </ul>

      <p class="mt"><strong>1.2 Ente Federativo</strong></p>
      <ul>
        <li><strong>1.2.1 Ente:</strong> <span data-k="ente"></span></li>
        <li><strong>1.2.2 CNPJ:</strong> <span data-k="cnpj_ente"></span></li>
        <li><strong>1.2.3 E-mail oficial para recebimento de comunicações do Programa:</strong> <span data-k="email_ente"></span></li>
      </ul>

      <p class="mt"><strong>1.3 Regime Próprio de Previdência Social (RPPS)</strong></p>
      <ul>
        <li><strong>1.3.1 Unidade Gestora:</strong> <span data-k="ug"></span></li>
        <li><strong>1.3.2 CNPJ:</strong> <span data-k="cnpj_ug"></span></li>
        <li><strong>1.3.3 E-mail oficial para recebimento de comunicações do Programa:</strong> <span data-k="email_ug"></span></li>
      </ul>
    </section>

    <!-- 2. RESPONSÁVEIS -->
    <section class="term-section">
      <h2>2. IDENTIFICAÇÃO DOS RESPONSÁVEIS</h2>

      <p><strong>2.1 Representante legal do ente federativo</strong></p>
      <ul>
        <li><strong>2.1.1 Nome:</strong> <span data-k="nome_rep_ente"></span></li>
        <li><strong>2.1.2 Cargo/Função:</strong> <span data-k="cargo_rep_ente"></span></li>
        <li><strong>2.1.3 CPF:</strong> <span data-k="cpf_rep_ente"></span></li>
        <li><strong>2.1.4 E-mail institucional para recebimento de comunicações do Programa:</strong> <span data-k="email_rep_ente"></span></li>
      </ul>

      <p class="mt"><strong>2.2 Representante legal do RPPS</strong></p>
      <ul>
        <li><strong>2.2.1 Nome:</strong> <span data-k="nome_rep_ug"></span></li>
        <li><strong>2.2.2 Cargo/Função:</strong> <span data-k="cargo_rep_ug"></span></li>
        <li><strong>2.2.3 CPF:</strong> <span data-k="cpf_rep_ug"></span></li>
        <li><strong>2.2.4 E-mail institucional para recebimento de comunicações do Programa:</strong> <span data-k="email_rep_ug"></span></li>
      </ul>
    </section>

    <!-- 3. CRP -->
    <section class="term-section">
      <h2>3. IDENTIFICAÇÃO DA SITUAÇÃO RELATIVA AO CERTIFICADO DE REGULARIDADE PREVIDENCIÁRIA (CRP)</h2>
      <ul>
        <li><strong>3.1 Data de vencimento do último CRP obtido:</strong> <span data-k="venc_ult_crp"></span></li>
        <li><strong>3.2 Tipo de emissão do último CRP:</strong> <span data-k="tipo_emissao_crp"></span></li>
      </ul>

      <div class="keep-together" id="sec-criterios">
        <p class="mt"><strong>3.3 Critério(s) irregular(es) no extrato previdenciário:</strong></p>
        <ul id="criterios-list"></ul>
      </div>
    </section>

    <!-- 4. FINALIDADES -->
    <section class="term-section">
      <h2>4. FINALIDADE(S) INICIAL(IS) DA ADESÃO AO PROGRAMA DE REGULARIDADE PREVIDENCIÁRIA</h2>

      <p><strong>Finalidade Inicial da Adesão:</strong> A - Parcelamento de débitos; e/ou B - Regularização de pendências para emissão administrativa e regular do CRP.</p>

      <p class="mt"><strong>4.1 Celebração de termos de parcelamento de débitos</strong></p>
      <ul>
        <li>4.1.1 em até sessenta parcelas (ADCT – EC nº XXX/2025); e/ou</li>
        <li>4.1.2 em até trezentas parcelas (ADCT + Portaria MTP nº 1.467/2022).</li>
        <li><strong>Escolha informada:</strong> <span data-k="celebracao"></span></li>
      </ul>

      <p class="mt"><strong>4.2 Regularização de pendências para a emissão administrativa e regular do CRP</strong></p>
      <ul>
        <li>4.2.1 para entes sem decisão judicial; ou 4.2.2 para entes com decisão judicial (RE 1.007.271 – Tema 968/STF).</li>
        <li><strong>Escolha informada:</strong> <span data-k="regularizacao"></span></li>
      </ul>

      <p class="mt"><strong>4.3 Equacionamento de déficit atuarial do RPPS</strong></p>
      <ul>
        <li>4.3.1 implementação de plano; 4.3.2 prazos adicionais; 4.3.3 plano alternativo (Portaria MTP nº 1.467/2022).</li>
        <li><strong>Escolha informada:</strong> <span data-k="deficit"></span></li>
      </ul>

      <p class="mt"><strong>4.4 Organização do RPPS conforme os critérios estruturantes estabelecidos nas normas gerais</strong></p>
      <ul>
        <li>4.4.1 adequação da Unidade Gestora Única (art. 40, §20, CF); e/ou 4.4.2 cumprimento de outro critério.</li>
        <li><strong>Escolha informada:</strong> <span data-k="criterios_estrut"></span></li>
      </ul>

      <p class="mt"><strong>4.5 Manutenção da conformidade do RPPS às normas gerais</strong></p>
      <ul><li><strong>Medidas informadas:</strong> <span data-k="manutencao_normas"></span></li></ul>

      <p class="small mt">
        Obs.: Acesso às fases específicas/Manutenção conforme requisitos do Anexo XVIII da Portaria MTP nº 1.467/2022, certificação Pró-Gestão RPPS/ISP-RPPS e medidas dos arts. 67 a 69.
        Nesta fase, caso necessário, poderão ser apresentados planos de ação para CRP emergenciais.
      </p>
    </section>

    <!-- 5. COMPROMISSOS -->
    <section class="term-section">
      <h2>5. COMPROMISSOS FIRMADOS NA ADESÃO AO PROGRAMA DE REGULARIDADE PREVIDENCIÁRIA</h2>
      <ul>
        <li>5.1 Regularidade nos repasses e nas parcelas de acordos (art. 14 e 15, Portaria MTP nº 1.467/2022).</li>
        <li>5.2 Regularidade no encaminhamento de documentos e atendimento às solicitações (art. 241).</li>
        <li>5.3 Utilização dos recursos previdenciários conforme Lei nº 9.796/1999.</li>
        <li>5.4 Aplicação dos recursos segundo normas do CMN.</li>
        <li>5.5 Adequações na legislação do RPPS quando identificadas pela Secretaria.</li>
        <li>5.6 Cumprimento dos Planos de Ação das fases Específica e de Manutenção.</li>
      </ul>
      <p><strong>Compromissos informados:</strong> <span data-k="compromisso"></span></p>
    </section>

    <!-- 6. PROVIDÊNCIAS -->
    <section class="term-section">
      <h2>6. PROVIDÊNCIAS NECESSÁRIAS PARA ADESÃO AO PROGRAMA</h2>
      <ul>
        <li>6.1 Inclusão, no Cadprev, de todos os débitos de contribuições/valores até a data da adesão; ou</li>
        <li>6.2 Declaração de inexistência de débitos (ou já regularizados) até a adesão.</li>
      </ul>
      <p><strong>Providências informadas:</strong> <span data-k="providencias"></span></p>
    </section>

    <!-- 7. CONDIÇÕES -->
    <section class="term-section">
      <h2>7. CONDIÇÕES PARA VIGÊNCIA DO PROGRAMA DE REGULARIDADE PREVIDENCIÁRIA</h2>
      <ul>
        <li>I – atendimento aos requisitos do art. 3º do Anexo XVIII;</li>
        <li>II – cumprimento dos planos de ação do art. 4º do Anexo XVIII;</li>
        <li>III – observância de prazos/condições do art. 6º do Anexo XVII (para parcelamentos – EC xx/2025); e/ou</li>
        <li>IV – não ingresso com ação judicial para obter CRP ou para descumprimento do Programa.</li>
      </ul>
      <p><strong>Declaração informada:</strong> <span data-k="condicao_vigencia"></span></p>
    </section>

    <!-- Assinaturas (primeiro Ente; abaixo RPPS) -->
    <footer class="term-footer">
      <p class="place-date"><span data-k="ente"></span>/<span data-k="uf"></span>, <span data-k="data_termo"></span>.</p>

      <div class="signature-line" aria-hidden="true"></div>
      <p class="signature-caption">
        <strong><span data-k="nome_rep_ente"></span></strong><br>
        <span id="sig-cap-ente">Representante legal do Município de <span data-k="ente"></span>/<span data-k="uf"></span></span>
      </p>

      <div class="signature-line" aria-hidden="true" style="margin-top:10mm"></div>
      <p class="signature-caption">
        <strong><span data-k="nome_rep_ug"></span></strong><br>
        Representante legal do <span data-k="ug"></span>
      </p>
    </footer>
  </main>

  <!-- libs: garantir disponibilidade global -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js" referrerpolicy="no-referrer"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js" referrerpolicy="no-referrer"></script>

  <script>
    // Executa somente após todas as libs carregarem
    window.addEventListener('load', () => {
      async function waitFonts(){ try{ if(document.fonts && document.fonts.ready) await document.fonts.ready; }catch{} }

      function hydrate(){
        const p = new URLSearchParams(location.search);
        const map = {
          uf:'uf', ente:'ente', esfera:'esfera',
          cnpj_ente:'cnpj_ente', email_ente:'email_ente',
          ug:'ug', cnpj_ug:'cnpj_ug', email_ug:'email_ug',
          nome_rep_ente:'nome_rep_ente', cargo_rep_ente:'cargo_rep_ente', cpf_rep_ente:'cpf_rep_ente', email_rep_ente:'email_rep_ente',
          nome_rep_ug:'nome_rep_ug', cargo_rep_ug:'cargo_rep_ug', cpf_rep_ug:'cpf_rep_ug', email_rep_ug:'email_rep_ug',
          venc_ult_crp:'venc_ult_crp', tipo_emissao_crp:'tipo_emissao_crp',
          celebracao:'celebracao', regularizacao:'regularizacao', deficit:'deficit',
          criterios_estrut:'criterios_estrut', manutencao_normas:'manutencao_normas', compromisso:'compromisso',
          providencias:'providencias', condicao_vigencia:'condicao_vigencia', data_termo:'data_termo'
        };
        Object.entries(map).forEach(([q,k])=>{
          const val=(p.get(q)||'').toString();
          document.querySelectorAll(`[data-k="${k}"]`).forEach(el=> el.textContent = val);
        });

        // 3.3 – lista de critérios marcados
        const ul = document.getElementById('criterios-list'); ul.innerHTML = '';
        const criterios = [];
        for (const [k,v] of p.entries()){
          if (/^criterio\d+$/i.test(k) && v) criterios.push(v);
        }
        if (!criterios.length){
          const li = document.createElement('li'); li.innerHTML = '<em>Não informado.</em>'; ul.appendChild(li);
        } else {
          criterios.forEach(c => { const li=document.createElement('li'); li.textContent=c; ul.appendChild(li); });
        }
      }

      function fitTitle(){ const t=document.getElementById('term-title'); if (t) t.style.whiteSpace='normal'; }

        // Só os LOGOS (sem o título) para repetir em todas as páginas
      async function captureHeaderDataURL(){
        const el = document.querySelector('.logos-wrap');
        const canvas = await html2canvas(el, {
          scale: 2, backgroundColor: '#fff', useCORS: true, scrollX: 0, scrollY: 0
        });
        return { dataURL: canvas.toDataURL('image/png'), w: canvas.width, h: canvas.height };
      }


      (function adaptSignatureCaption(){
        const p = new URLSearchParams(location.search);
        const esfera = (p.get('esfera')||'').toLowerCase();
        const el = document.getElementById('sig-cap-ente');
        if (!el) return;
        if (esfera.includes('estadual') || esfera.includes('distrital')){
          el.innerHTML = 'Representante legal do Estado/Distrito de <span data-k="ente"></span>/<span data-k="uf"></span>';
        } // municipal já está no HTML
      })();

      function sanitizeFilename(s){
      return String(s || 'Sem município').replace(/[\\/:*?"<>|]+/g,'').trim();
      }

      async function generatePdf(){
        await waitFonts();
        fitTitle();

        // Nome do arquivo: Form_Prog_Reg_Prev - <Município-UF>.pdf
        const p         = new URLSearchParams(location.search);
        const enteRaw   = (p.get('ente') || '').trim();
        const ufRaw     = (p.get('uf')   || '').trim();
        const municipio = sanitizeFilename(enteRaw);
        const ufSafe    = sanitizeFilename(ufRaw);
        const muniUF    = municipio ? `${municipio}${ufSafe ? `-${ufSafe}` : ''}` : 'Sem municipio';
        const filename  = `Form_Prog_Reg_Prev - ${muniUF}.pdf`;

        // Captura somente as LOGOS para repetir no topo de todas as páginas
        const header = await captureHeaderDataURL();
        const ratio  = header.h / header.w;

        // --- Layout em milímetros (A4 retrato) ---
        const PAGE_W_MM     = 210;
        const SIDE_PAD_MM   = 15;           // margens esquerda/direita/conteúdo
        const HEAD_TOP_MM   = 6;            // distância do topo da página p/ as logos (↓ sobe o cabeçalho)
        const headerWmm     = PAGE_W_MM - 2*SIDE_PAD_MM;
        const headerHmm     = headerWmm * ratio;
        const GAP_BELOW_HDR = 3;            // respiro abaixo do cabeçalho

        // Esconde apenas as LOGOS durante a exportação (título continua visível)
        document.getElementById('pdf-root').classList.add('pdf-export');

        const opt = {
          // top, left, bottom, right
          margin: [HEAD_TOP_MM + headerHmm + GAP_BELOW_HDR, SIDE_PAD_MM, SIDE_PAD_MM, SIDE_PAD_MM],
          filename,
          html2canvas: { scale:2, letterRendering:1, useCORS:true, backgroundColor:'#fff', scrollX:0, scrollY:0 },
          jsPDF: { unit:'mm', format:'a4', orientation:'portrait' },
          pagebreak: { mode:['css','legacy'] }
        };

        const root   = document.getElementById('pdf-root');
        const worker = html2pdf().set(opt).from(root).toPdf();

        // Desenha o cabeçalho em TODAS as páginas
        await worker.get('pdf').then(pdf => {
          const pages = pdf.getNumberOfPages ? pdf.getNumberOfPages() : pdf.internal.getNumberOfPages();
          for (let i = 1; i <= pages; i++) {
            pdf.setPage(i);
            pdf.addImage(header.dataURL, 'PNG', SIDE_PAD_MM, HEAD_TOP_MM, headerWmm, headerHmm, undefined, 'FAST');
          }
        }).save();

        document.getElementById('pdf-root').classList.remove('pdf-export');
      }   


      (function init(){
        hydrate(); fitTitle();
        const auto = new URLSearchParams(location.search).get('auto');
        if (auto !== null){
          document.documentElement.classList.add('auto-download');
          generatePdf().then(()=>{ try{ window.close(); }catch{} });
        }
      })();
    });
  </script>
</body>
</html>
