<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Termo de Solicita√ß√£o de CRP Emergencial</title>

  <!-- Fonte apenas para PREVIEW em tela (o PDF usa Rawline do CSS local) -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&family=Montserrat:wght@600;700&display=swap" rel="stylesheet">

  <!-- Estilos oficiais do termo (usa Rawline no PDF) -->
  <link rel="stylesheet" href="./termo_solic_crp.css">
</head>
<body>
  <!-- Cabe√ßalho FIXO (anti-sobreposi√ß√£o em 2+ p√°ginas) -->
  <header class="prp-header" aria-hidden="true">
    <div class="logos-wrap">
      <img src="./imagens/logo-secretaria-complementar.svg" alt="Secretaria" loading="eager" />
      <img src="./imagens/logo-termo-drpps.svg" alt="Departamento de RPPS" loading="eager" />
    </div>
  </header>

  <div id="pdf-root">
    <main class="term-wrap prp-content">
      <h1 class="term-title">
        <br>TERMO DE SOLICITA√á√ÉO DE CRP EMERGENCIAL<br>
        PROGRAMA DE REGULARIDADE PREVIDENCI√ÅRIA<br>
      </h1>

      <p class="term-meta">
        Ente: <strong data-k="ente"></strong> / UF: <strong data-k="uf"></strong> ‚Ä¢ UG: <strong data-k="ug"></strong>
      </p>
      <!-- 1. IDENTIFICA√á√ÉO -->
      <section class="term-section avoid-break" id="sec-1">
        <h2><br>1. IDENTIFICA√á√ÉO DO ENTE FEDERATIVO E DA UNIDADE GESTORA</h2>

        <h3><span class="label">1.1 Esfera de Governo</span></h3>
        <div class="linha">
          <div class="titulo"></div>
          <div class="valor" data-esfera></div>
        </div>

        <h3><strong>1.2 Ente Federativo</strong></h3>
        <div class="grid grid-num">
          <div class="field"><span class="label"><strong>1.2.1 Ente</strong></span><span class="value" data-k="ente"></span></div>
          <div class="field"><span class="label"><strong>1.2.2 CNPJ</strong></span><span class="value" data-k="cnpj_ente"></span></div>
          <div class="field"><span class="label"><strong>1.2.3 E-mail oficial</strong></span><span class="value" data-k="email_ente"></span></div>
        </div>

        <h3 id="sec-1-3"><strong>1.3 Regime Pr√≥prio de Previd√™ncia Social (RPPS)</strong></h3>
        <div class="grid grid-num">
          <div class="field"><span class="label"><strong>1.3.1 Unidade Gestora</strong></span><span class="value" data-k="ug"></span></div>
          <div class="field"><span class="label"><strong>1.3.2 CNPJ</strong></span><span class="value" data-k="cnpj_ug"></span></div>
          <div class="field"><span class="label"><strong>1.3.3 E-mail oficial</strong></span><span class="value" data-k="email_ug"></span></div>
          <div class="field"><span class="label"><strong>1.3.4 √ìrg√£o de vincula√ß√£o da UG</strong></span><span class="value" data-k="ORGAO_VINCULACAO_UG"></span></div>
        </div>
      </section>

      <!-- 2. IDENTIFICA√á√ÉO DOS RESPONS√ÅVEIS -->
      <section class="term-section avoid-break">
        <h2>2. IDENTIFICA√á√ÉO DOS RESPONS√ÅVEIS</h2>

        <h3><strong>2.1 Representante legal do ente federativo</strong></h3>
        <div class="grid grid-num">
          <div class="field"><span class="label"><strong>2.1.1 Nome</strong></span><span class="value" data-k="nome_rep_ente"></span></div>
          <div class="field"><span class="label"><strong>2.1.2 Cargo/Fun√ß√£o</strong></span><span class="value" data-k="cargo_rep_ente"></span></div>
          <div class="field"><span class="label"><strong>2.1.3 CPF</strong></span><span class="value" data-k="cpf_rep_ente"></span></div>
          <div class="field"><span class="label"><strong>2.1.4 E-mail</strong></span><span class="value" data-k="email_rep_ente"></span></div>
          <div class="field"><span class="label"><strong>2.1.5 Telefone</strong></span><span class="value" data-k="tel_rep_ente"></span></div>
        </div>

        <h3>2.2 Representante legal do RPPS</h3>
        <div class="grid grid-num">
          <div class="field"><span class="label"><strong>2.2.1 Nome</strong></span><span class="value" data-k="nome_rep_ug"></span></div>
          <div class="field"><span class="label"><strong>2.2.2 Cargo/Fun√ß√£o</strong></span><span class="value" data-k="cargo_rep_ug"></span></div>
          <div class="field"><span class="label"><strong>2.2.3 CPF</strong></span><span class="value" data-k="cpf_rep_ug"></span></div>
          <div class="field"><span class="label"><strong>2.2.4 E-mail</strong></span><span class="value" data-k="email_rep_ug"></span></div>
          <div class="field"><span class="label"><strong>2.2.5 Telefone</strong></span><span class="value" data-k="tel_rep_ug"></span></div>
        </div>
      </section>
      <!-- 3. SITUA√á√ÉO RELATIVA AO CRP -->
      <section class="term-section avoid-break page-break" id="sec-3">
        <h2>3. SITUA√á√ÉO RELATIVA AO CERTIFICADO DE REGULARIDADE PREVIDENCI√ÅRIA (CRP)</h2>

        <!-- 3.1 Data de vencimento do √∫ltimo CRP -->
        <div class="linha">
          <div class="rotulo">3.1 Data de vencimento do √∫ltimo CRP</div>
          <div class="valor">
            <span data-k="data_vencimento_ultimo_crp" data-fallback="DATA_VENC_ULTIMO_CRP" data-na="‚Äî"></span>
          </div>
        </div>

        <!-- 3.2 Tipo de emiss√£o do √∫ltimo CRP -->
        <div class="linha">
          <div class="rotulo">3.2 Tipo de emiss√£o do √∫ltimo CRP</div>
          <div class="valor">
            <span data-k="tipo_emissao_ult_crp" data-fallback="TIPO_EMISSAO_ULTIMO_CRP" data-na="‚Äî"></span>
          </div>
        </div>

        <h3>3.3 Crit√©rio(s) atualmente irregular(es) no extrato previdenci√°rio</h3>
        <p class="small">Selecione todos os itens apontados como irregulares no extrato.</p>
        <ul id="criterios-list"
            data-empty="Sem irregularidades informadas.">
        </ul>

        <!-- 3.4 -->
        <div class="linha">
          <h2>3.4 Solicita√ß√£o de Prazo Adicional</h2>
          <div class="valor">
            <div data-3_4="3.4.1">3.4.1 Manuten√ß√£o da conformidade</div>
            <div data-3_4="3.4.2">3.4.2 Equacionamento do d√©ficit atuarial (ou necessidade de prazo adicional para implementar)</div>
            <div data-3_4="3.4.3">3.4.3 Organiza√ß√£o do RPPS conforme crit√©rios estruturantes (inclui art. 40, ¬ß 20, CF)</div>
            <div data-3_4="3.4.4">3.4.4 Outro crit√©rio que apresente (ou possa apresentar) maior complexidade</div>
            <div data-k="PRAZO_ADICIONAL_TEXTO" class="d-none"></div>
          </div>
        </div>
      </section>
      <!-- 4. FASE DO PROGRAMA -->
      <section class="term-section avoid-break" id="sec-fase">
        <h2>4. IDENTIFICA√á√ÉO DA FASE DO PROGRAMA DE REGULARIDADE PREVIDENCI√ÅRIA</h2>
        
        <p class="small">
          Fase selecionada:
          <strong id="fase-escolhida" data-k="FASE_PROGRAMA"></strong>
        </p>
        <p class="small mt"><strong>Campos adicionais desta fase:</strong></p>
        <div id="fase-extra-campos"></div>

        <div class="avoid-break phase-block" id="fase-41" hidden>
          <h3>4.1 Fase Geral/Introdut√≥ria ‚Äì 1¬∫ CRP Emergencial</h3>
          <ul id="f41-itens" class="clean-list" data-empty="N√£o preenchido"></ul>
        </div>

        <div class="avoid-break phase-block" id="fase-42" hidden>
          <h3>4.2 Fase Geral/Introdut√≥ria ‚Äì 2¬∫ CRP Emergencial</h3>
          <p class="small"><strong>4.2.1</strong> Regularidade nos seguintes crit√©rios do extrato previdenci√°rio:</p>
          <ul id="f42-itens" class="styled-list" data-empty="N√£o preenchido"></ul>
        </div>

        <div class="avoid-break phase-block" id="fase-43">
          <h3>4.3 Fase Intermedi√°ria/Preparat√≥ria ‚Äì 3¬∫ CRP Emergencial</h3>

          
          <div class="sub-section" id="f43-sub-1">
            <p class="small"><strong>4.3.1 Manuten√ß√£o de regularidade nos crit√©rios relativos a repasses, aportes e parcelamento:</strong></p>
            <ul id="f43-1" class="styled-list" data-empty="N√£o preenchido"></ul>
          </div>
          
          <div class="sub-section" id="f43-sub-2">
            <p class="small"><strong>4.3.2 Regularidade quanto √† utiliza√ß√£o de recursos previdenci√°rios:</strong></p>
            <ul id="f43-2" class="styled-list" data-empty="N√£o preenchido"></ul>
          </div>

          <div class="sub-section" id="f43-sub-3">
            <p class="small"><strong>4.3.3 Regularidade quanto √† aplica√ß√£o dos recursos previdenci√°rios no mercado financeiro:</strong></p>
            <ul id="f43-3" class="styled-list" data-empty="N√£o preenchido"></ul>
          </div>
          
          <div class="sub-section" id="f43-sub-4">
            <p class="small"><strong>4.3.4 Regularidade quanto aos limites de contribui√ß√£o (EC 103/2019 e Lei 9.717/1998):</strong></p>
            <ul id="f43-4" class="styled-list" data-empty="N√£o preenchido"></ul>
          </div>
          
          <div class="sub-section" id="f43-sub-5">
            <p class="small"><strong>4.3.5 Regularidade quanto √† limita√ß√£o do rol de benef√≠cios (EC 103/2019):</strong></p>
            <ul id="f43-5" class="styled-list" data-empty="N√£o preenchido"></ul>
          </div>
          
          <div class="sub-section" id="f43-sub-6">
            <p class="small"><strong>4.3.6 Regularidade quanto √† institui√ß√£o por lei do Regime de Previd√™ncia Complementar ‚Äì RPC:</strong></p>
            <ul id="f43-6" class="styled-list" data-empty="N√£o preenchido"></ul>
          </div>
          
          <div class="sub-section" id="f43-sub-7">
            <p class="small"><strong>4.3.7 Regularidade quanto ao envio de dados e informa√ß√µes do RPPS:</strong></p>
            <ul id="f43-7" class="styled-list" data-empty="N√£o preenchido"></ul>
          </div>
          
          <div class="sub-section" id="f43-sub-8">
            <p class="small"><strong>4.3.8 Regularidade quanto √† operacionaliza√ß√£o da compensa√ß√£o previdenci√°ria:</strong></p>
            <ul id="f43-8" class="styled-list" data-empty="N√£o preenchido"></ul>
          </div>
          
          <div class="sub-section" id="f43-sub-9">
            <p class="small"><strong>4.3.9 Regularidade quanto aos requisitos dos dirigentes e colegiados (art. 8¬∫-B da Lei 9.717/1998):</strong></p>
            <ul id="f43-9" class="styled-list" data-empty="N√£o preenchido"></ul>
          </div>

          <div class="sub-section" id="f43-sub-10">
              <p class="small"><strong>4.3.10 ‚Äì Em rela√ß√£o √† adequa√ß√£o das regras de benef√≠cios do RPPS √† Emenda Constitucional n¬∫ 103/2019:</strong></p>
              <div id="f43-opcao-a" class="field-group" hidden>
                  <p>a) Foram adotadas regras de elegibilidade, de c√°lculo e de reajustamento dos benef√≠cios do RPPS (reforma das regras de benef√≠cios)...</p>
                  <p class="label-like">Relacionar a legisla√ß√£o que adequou as regras de benef√≠cios do RPPS √† Emenda Constitucional n¬∫ 103/2019:</p>
                  <div class="value-block" id="val-f4310-leg"></div>
              </div>
              <div id="f43-opcao-b" class="field-group" hidden>
                  <p>b) Comprovamos o encaminhamento, pelo ente ao Poder Legislativo, de propostas de altera√ß√£o...</p>
                  <p class="label-like">Lista de documentos anexados, que comprovam o encaminhamento dos projetos de altera√ß√£o das regras de benef√≠cios:</p>
                  <div class="value-block" id="val-f4310-docs"></div>
              </div>
          </div>

          <div class="sub-section" id="f43-sub-11">
              <p class="small"><strong>4.3.11 - Solicita√ß√£o de inclus√£o de crit√©rios nos Planos de A√ß√£o da Fase Espec√≠fica</strong></p>
              <p class="label-like">a) Crit√©rios do extrato que o ente deseja incluir no Plano de A√ß√£o da Fase Espec√≠fica:</p>
              <ul id="f43-crit-incluir" class="styled-list" style="display:block; list-style:none; padding-left:0;"></ul>
              
              <p class="label-like">b) Justificativas/Informa√ß√µes apresentadas relativas a essa inclus√£o (anexos podem ser citados abaixo):</p>
              <div class="value-block" id="f43-just-11"></div>
              
              <p class="small text-muted small">Obs.: A solicita√ß√£o de inclus√£o no Plano de A√ß√£o n√£o se aplica aos seguintes crit√©rios: ‚ÄúDIPR - Consist√™ncia e Car√°ter Contributivo‚Äù; ‚ÄúCar√°ter contributivo - Repasse (objeto de PAP)‚Äù e ‚ÄúUtiliza√ß√£o dos recursos previdenci√°rios (objeto de PAP)‚Äù.</p>
          </div>

          <div class="sub-section" id="f43-sub-12">
              <p class="small"><strong>4.3.12 Solicita√ß√£o de inclus√£o de crit√©rios nos Planos de A√ß√£o da Fase Espec√≠fica</strong></p>
              <p class="small text-muted small">S√≥ aparecer√£o os crit√©rios para assinalar se marcada a op√ß√£o acima. Apresentar todos os crit√©rios do Extrato.</p>
              <p class="label-like">a) Crit√©rios do extrato que o ente, comprovadamente, precisar√° incluir em Plano de A√ß√£o:</p>
              <ul id="f43-crit-incluir-12" class="styled-list" data-empty="N√£o preenchido"></ul>

              <p class="label-like">b) Justificativas/informa√ß√µes apresentadas relativas √† solicita√ß√£o de inclus√£o (anexos podem ser citados abaixo):</p>
              <div class="value-block" id="f43-just-12" data-field="F4312_JUST" data-empty="N√£o informado"></div>

              <p class="label-like">c) Descrever sucintamente o(s) Plano(s) de A√ß√£o apresentado(s)</p>
              <div class="value-block" id="f43-desc-planos-12" data-field="F4312_DESC_PLANOS" data-empty="N√£o informado"></div>

              <p class="small text-muted small">Obs.: A solicita√ß√£o de inclus√£o no Plano de A√ß√£o n√£o se aplica aos seguintes crit√©rios: ‚ÄúDIPR - Consist√™ncia e Car√°ter Contributivo‚Äù; ‚ÄúCar√°ter contributivo - Repasse (objeto de PAP)‚Äù e ‚ÄúUtiliza√ß√£o dos recursos previdenci√°rios (objeto de PAP)‚Äù.</p>
          </div>
        </div>


        <div class="avoid-break phase-block" id="fase-44" hidden>
          <h3>4.4 Fase Espec√≠fica/Focalizada ‚Äì 4¬∫ CRP Emergencial</h3>

          <div class="sub-section" id="f44-sub-1">
            <p class="small"><strong>4.4.1 Declaro ter cumprido as seguintes condi√ß√µes:</strong></p>
            <ul id="f44-decls" class="styled-list" data-empty="N√£o preenchido"></ul>
            <div id="f44-leg-wrap" class="field-group" hidden>
              <p class="label-like">Relacionar a legisla√ß√£o que adequou as regras de benef√≠cios do RPPS √† EC 103/2019:</p>
              <div class="value-block" data-k="F441_LEGISLACAO"></div>
            </div>
          </div>
          
          <div class="sub-section" id="f44-sub-2">
            <p class="small"><strong>4.4.2 Finalidade do(s) Plano(s) de A√ß√£o apresentado(s)</strong></p>
            <ul id="f44-finalidades" class="styled-list" data-empty="N√£o preenchido"></ul>
          </div>
          
          <div class="sub-section" id="f44-sub-3">
            <p class="small"><strong>4.4.3 Crit√©rio(s) do extrato previdenci√°rio objeto do(s) Plano(s) de A√ß√£o</strong></p>
            <ul id="f44-criterios" class="styled-list" data-empty="N√£o preenchido"></ul>
          </div>
          
          <div class="sub-section" id="f44-sub-4">
            <p class="small"><strong>4.4.4 Anexos (obrigat√≥rio o encaminhamento de Planos de A√ß√£o e documenta√ß√£o comprobat√≥ria)</strong></p>
            <div class="value-block" data-k="F44_ANEXOS"></div>
          </div>
          
          <div class="sub-section" id="f44-sub-5">
            <p class="small"><strong>4.4.5 Descrever sucintamente o(s) Plano(s) de A√ß√£o apresentado(s):</strong></p>
            <div class="value-block" data-k="F445_DESC_PLANOS"></div>
          </div>
          
          <div class="sub-section" id="f44-sub-6">
            <p class="small"><strong>4.4.6 Em caso de Plano(s) de A√ß√£o apresentado(s) na Fase Intermedi√°ria:</strong></p>
            <p class="label-like">a) Comprova√ß√£o do cumprimento do(s) Plano(s) de A√ß√£o (relacione os documentos, um por linha)</p>
            <div class="value-block" data-k="F446_DOCS"></div>
            <p class="label-like">b) Descrever sucintamente a execu√ß√£o do(s) Plano(s) de A√ß√£o e os resultados alcan√ßados</p>
            <div class="value-block" data-k="F446_EXEC_RES"></div>
          </div>
        </div>

        <div class="avoid-break phase-block" id="fase-45" hidden>
          <h3>4.5 Fase Espec√≠fica/Focalizada ‚Äì 5¬∫ CRP Emergencial</h3>
          <ul id="f45-decls" class="styled-list" data-empty="N√£o preenchido">
            </ul>
          
          <div class="sub-section" id="f45-sub-2">
            <p class="small"><strong>4.5.2 Comprova√ß√£o do cumprimento do(s) Plano(s) de A√ß√£o</strong></p>
            <div class="value-block" data-k="F45_DOCS"></div>
          </div>
          
          <div class="sub-section" id="f45-sub-4">
            <p class="small"><strong>4.5.4 Justificativas</strong></p>
            <div class="value-block" data-k="F45_JUST"></div>
          </div>
          
          <div class="sub-section" id="f45-sub-3">
            <p class="small"><strong>4.5.3 Descrever sucintamente a execu√ß√£o do(s) Plano(s) de A√ß√£o e os resultados alcan√ßados</strong></p>
            <div class="value-block" data-k="F453_EXEC_RES"></div>
          </div>
        </div>

        <div class="avoid-break phase-block" id="fase-46" hidden>
          <h3>4.6 Fase de Manuten√ß√£o da Conformidade</h3>

          <div class="sub-section" id="f46-sub-1">
            <p class="small"><strong>4.6.1 Declaro ter cumprido as seguintes condi√ß√µes:</strong></p>
            <p class="label-like">a) Demais crit√©rios que n√£o s√£o objeto do Plano(s) de A√ß√£o est√£o regulares.</p>
            <ul id="f46-criterios" class="styled-list" data-empty="N√£o preenchido"></ul>
            
            <p class="label-like">b) N√≠vel de certifica√ß√£o no Pr√≥-Gest√£o RPPS</p>
            <div class="value-block" data-k="F46_PROGESTAO"></div>
            
            <p class="label-like">c) Grupo de Porte (ISP-RPPS)</p>
            <div class="value-block" data-k="F46_PORTE"></div>
            
            <p class="label-like">d) Houve melhora na situa√ß√£o financeira e atuarial do RPPS...</p>
            <p class="label-like nested">Justificativas (item d)</p>
            <div class="value-block" data-k="F46_JUST_D"></div>
            <p class="label-like nested">Documentos (item d)</p>
            <div class="value-block" data-k="F46_DOCS_D"></div>
            
            <p class="label-like">e) Medidas de acompanhamento atuarial...</p>
            <p class="label-like nested">Justificativas (item e)</p>
            <div class="value-block" data-k="F46_JUST_E"></div>
            <p class="label-like nested">Documentos (item e)</p>
            <div class="value-block" data-k="F46_DOCS_E"></div>
          </div>

          <div class="sub-section" id="f46-sub-2">
            <p class="small"><strong>4.6.2 Finalidade do(s) Plano(s) de A√ß√£o apresentado(s)</strong></p>
            <ul id="f46-finalidades" class="styled-list" data-empty="N√£o preenchido"></ul>
            <ul id="f46-crit-f" class="styled-list nested-list" data-empty="N√£o preenchido">
              </ul>
          </div>
          
          <div class="sub-section" id="f46-sub-6">
            <p class="small"><strong>4.6.6 Em caso de Plano(s) de A√ß√£o em execu√ß√£o ou conclu√≠do(s):</strong></p>
            <p class="label-like">a) Comprova√ß√£o do cumprimento do(s) Plano(s) de A√ß√£o (relacione os documentos, um por linha)</p>
            <div class="value-block" data-k="F466_DOCS"></div>
            <p class="label-like">b) Descrever sucintamente a execu√ß√£o do(s) Plano(s) de A√ß√£o e os resultados alcan√ßados</p>
            <div class="value-block" data-k="F466_EXEC_RES"></div>
          </div>
        </div>

      </section>
      <!-- 5. JUSTIFICATIVAS GERAIS -->
      <section class="term-section avoid-break">
        <h2>5. JUSTIFICATIVAS / INFORMA√á√ïES ADICIONAIS</h2>
        <p data-k="justificativas_gerais"></p>
      </section>

      <!-- For√ßa p√°gina nova antes das assinaturas -->
      <div class="break-before"></div>

      <!-- Assinaturas -->
      <footer class="term-footer">
        <p class="place-date"><span data-k="ente"></span>/<span data-k="uf"></span>, <span data-k="data_termo"></span>.</p>

        <div class="signature-block">
          <div class="signature-line" aria-hidden="true"></div>
          <p class="signature-caption">
            <strong><span data-k="nome_rep_ente"></span></strong><br>
            <span id="sig-cap-ente">Representante legal do Munic√≠pio de <span data-k="ente"></span>/<span data-k="uf"></span></span>
          </p>
        </div>

        <div class="signature-block">
          <div class="signature-line" aria-hidden="true"></div>
          <p class="signature-caption">
            <strong><span data-k="nome_rep_ug"></span></strong><br>
            Representante legal do <span data-k="ug"></span>
          </p>
        </div>
      </footer>
    </main>
  </div>

  <!-- Modal "Gerando PDF‚Ä¶" -->
  <div id="pdf-modal" class="pdf-modal" aria-hidden="true">
    <div class="pdf-modal__backdrop"></div>
    <div class="pdf-modal__box" role="dialog" aria-modal="true" aria-label="Gerando PDF">
      <div class="pdf-modal__header">Gerando PDF‚Ä¶</div>
      <div class="pdf-modal__body">
        <p>Aguarde, preparando o arquivo.</p>
        <div class="spinner" aria-hidden="true"></div>
      </div>
    </div>
  </div>
  <!-- Script embutido -->

  <script>
    (function () {
      const $  = (s, r=document) => r.querySelector(s);
      const $$ = (s, r=document) => Array.from(r.querySelectorAll(s));

      /* ===== Fallbacks ‚ÄúN√£o informado‚Äù ===== */
      const __NA_LABEL__ = () =>
        String((window.__TERMO_DATA__ && window.__TERMO_DATA__.__NA_LABEL) || 'N√£o informado');
      const __NA_ALL__ = () => {
        const d = window.__TERMO_DATA__;
        return (d && Object.prototype.hasOwnProperty.call(d, '__NA_ALL'))
          ? !!d.__NA_ALL : true;
      };
      function fillText(key, val){
        const raw = (val == null) ? '' : String(val);
        const trimmed = raw.trim();
        const s = trimmed || (__NA_ALL__() ? __NA_LABEL__() : '');
        $$('[data-k="'+key+'"]').forEach(el => { el.textContent = s; });
      }

      /* ===== Utilit√°rios ===== */
      function escapeHtml(s){ return String(s||'').replace(/[&<>\"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'})[m]); }

      function asArr(v){
        if (Array.isArray(v)) return v;
        if (v == null || v === '') return [];
        if (typeof v === 'string') {
          const s = v.trim();
          if (!s) return [];
          // Tenta JSON primeiro (caso venha stringified)
          if ((s.startsWith('[') && s.endsWith(']'))) {
            try {
              const j = JSON.parse(s);
              if (Array.isArray(j)) return j.filter(Boolean).map(x=>String(x).trim()).filter(Boolean);
            } catch(_) {}
          }
          // CR√çTICO: Separa por ponto-e-v√≠rgula (padr√£o do seu frontend) ou quebra de linha
          return s.split(/;|\r?\n/).map(t=>t.trim()).filter(Boolean);
        }
        return [String(v)].filter(Boolean);
      }

      function splitLines(s){ return String(s||'').split(/\r?\n/).map(t=>t.trim()).filter(Boolean); }

      function liList(sel, arr){
        const ul = document.querySelector(sel);
        if (!ul) return false; 
        const a = asArr(arr);
        
        // Se tiver itens, preenche e retorna true
        if (a.length) {
          ul.innerHTML = a.map(x=>`<li>${escapeHtml(x)}</li>`).join('');
          return true;
        } 
        
        // Se vazio, limpa o HTML para n√£o ocupar espa√ßo no PDF
        ul.innerHTML = ''; 
        return false;
      }
      const fillList = liList;

      function renderParagraphs(sel, s){
        const el = document.querySelector(sel);
        if (!el) return false;
        const lines = splitLines(s);
        
        if (lines.length) {
          el.innerHTML = lines.map(x=>`<p>${escapeHtml(x)}</p>`).join('');
          return true;
        }
        el.innerHTML = ''; 
        return false;
      }
      const fillBlock = renderParagraphs;

      function fillValue(sel, val) {
        const el = $(sel);
        if (!el) return false;
        const s = String(val || '').trim();
        if (s) {
          el.innerHTML = escapeHtml(s).replace(/\r?\n/g, '<br>');
          return true;
        }
        el.innerHTML = ''; 
        return false;
      }

      function show(sel, visible) {
        const el = $(sel);
        if (el) {
          el.hidden = !visible;
          el.style.display = visible ? '' : 'none';
        }
      }

      /* ===== Normaliza√ß√£o do payload (AQUI EST√Å A M√ÅGICA) ===== */
      function normalizePayload(p0){
        const p = Object.assign({}, p0);

        // Helper para buscar chaves de forma insens√≠vel (min√∫sculo, mai√∫sculo, array)
        const getAny = (...keys) => {
            for (const k of keys) {
                if (p[k] !== undefined && p[k] !== null && p[k] !== '') return p[k];
                // Tenta vers√£o lowercase (comum vindo do server.js flatten)
                const lower = k.toLowerCase();
                if (p[lower] !== undefined && p[lower] !== null && p[lower] !== '') return p[lower];
            }
            return undefined;
        };

        // 3.1 e 3.2 CRP
        p.DATA_VENC_ULTIMO_CRP = getAny('DATA_VENC_ULTIMO_CRP', 'DATA_VENCIMENTO_ULTIMO_CRP', 'venc_ult_crp', 'data_vencimento_ultimo_crp') || '';
        p.TIPO_EMISSAO_ULTIMO_CRP = getAny('TIPO_EMISSAO_ULTIMO_CRP', 'tipo_emissao_ult_crp', 'tipo_emissao_ultimo_crp', 'tipo') || '';
        
        let tCrp = String(p.TIPO_EMISSAO_ULTIMO_CRP).trim().toLowerCase();
        if (tCrp.startsWith('adm') || tCrp === 'nao' || tCrp === 'n') p.TIPO_EMISSAO_ULTIMO_CRP = 'Administrativa';
        if (tCrp.startsWith('jud') || tCrp === 'sim' || tCrp === 's') p.TIPO_EMISSAO_ULTIMO_CRP = 'Judicial';
        
        // Espelhos data-k
        p.data_vencimento_ultimo_crp = p.DATA_VENC_ULTIMO_CRP;
        p.tipo_emissao_ult_crp = p.TIPO_EMISSAO_ULTIMO_CRP;

        // 3.3 Crit√©rios
        p.__CRITERIOS_ARR__ = asArr(getAny('CRITERIOS_IRREGULARES', 'CRITERIOS_LIST', 'criterios_irregulares'));

        // 3.4 Prazo Adicional
        p.PRAZO_ADICIONAL_TEXTO = getAny('PRAZO_ADICIONAL_TEXTO', 'prazo_adicional_texto') || '';
        let prazoCod = getAny('PRAZO_ADICIONAL_COD', 'prazo_adicional_cod', 'prazo_adicional');
        if (prazoCod) {
             const m = String(prazoCod).match(/3\.[24]\.(\d)/);
             if (m) prazoCod = `3.4.${m[1]}`;
        }
        p.PRAZO_ADICIONAL_COD = prazoCod || '';

        // 4. Fase Selecionada
        p.__FASE_SEL__ = String(getAny('__FASE_SEL__', 'FASE_PROGRAMA', 'fase_programa', 'FASE') || '').trim();

        // === LISTAS DAS FASES ===
        
        // 4.1
        p.F41_OPCAO_TEXT = getAny('F41_OPCAO_TEXT', 'F41_OPCAO', 'f41_opcao', 'CELEBRACAO_TERMO_PARCELA_DEBITOS') || '';

        // 4.2
        p.F42_LISTA = asArr(getAny('F42_LISTA', 'F42_LISTA[]', 'F42_ITENS', 'F42_ITENS[]'));

        // 4.3 (Seus campos problem√°ticos)
        p.F43_LISTA = asArr(getAny(
          'F43_LISTA', 'F43_LISTA[]', 'F43_LISTA_TXT', 'F43_LISTA_TXT[]',
          'F43_ITENS', 'F43_ITENS[]'
        ));
        p.F43_INCLUIR = asArr(getAny('F43_INCLUIR', 'F43_INCLUIR[]', 'F43_INCLUIR_TXT', 'f43_incluir'));
        p.F43_INCLUIR_B = asArr(getAny('F43_INCLUIR_B', 'F43_INCLUIR_B[]', 'F43_INCLUIR_B_TXT', 'f43_incluir_b'));
        
        p.F43_PLANO = getAny('F43_PLANO', 'f43_plano') || '';
        p.F43_PLANO_B = getAny('F43_PLANO_B', 'f43_plano_b') || '';
        p.F43_DESC_PLANOS = getAny('F43_DESC_PLANOS', 'f43_desc_planos') || '';
        p.F43_JUST = getAny('F43_JUST', 'f43_just') || '';
        
        p.F4310_OPCAO = getAny('F4310_OPCAO', 'f4310_opcao') || '';
        p.F4310_LEGISLACAO = getAny('F4310_LEGISLACAO', 'f4310_legislacao') || '';
        p.F4310_DOCS = getAny('F4310_DOCS', 'f4310_docs') || '';

        // 4.4
        p.F44_CRITERIOS = asArr(getAny('F44_CRITERIOS', 'F44_CRITERIOS[]', 'f44_criterios'));
        p.F44_DECLS = asArr(getAny('F44_DECLS', 'F44_DECLS[]', 'f44_decls'));
        p.F44_FINALIDADES = asArr(getAny('F44_FINALIDADES', 'F44_FINALIDADES[]', 'f44_finalidades'));
        p.F44_ANEXOS = getAny('F44_ANEXOS', 'f44_anexos') || '';
        p.F441_LEGISLACAO = getAny('F441_LEGISLACAO', 'f441_legislacao') || '';
        p.F445_DESC_PLANOS = getAny('F445_DESC_PLANOS', 'f445_desc_planos') || '';
        p.F446_DOCS = getAny('F446_DOCS', 'f446_docs') || '';
        p.F446_EXEC_RES = getAny('F446_EXEC_RES', 'f446_exec_res') || '';

        // 4.5
        p.F45_DECLS = asArr(getAny('F45_DECLS', 'F45_DECLS[]', 'f45_decls', 'F45_CONDICOES[]'));
        p.F45_DOCS = getAny('F45_DOCS', 'f45_docs') || '';
        p.F45_JUST = getAny('F45_JUST', 'f45_just') || '';
        p.F453_EXEC_RES = getAny('F453_EXEC_RES', 'f453_exec_res') || '';

        // 4.6
        p.F46_CRITERIOS = asArr(getAny('F46_CRITERIOS', 'F46_CRITERIOS[]', 'f46_criterios'));
        p.F46_FINALIDADES = asArr(getAny('F46_FINALIDADES', 'F46_FINALIDADES[]', 'f46_finalidades'));
        p.F462F_CRITERIOS = asArr(getAny('F462F_CRITERIOS', 'F462F_CRITERIOS[]', 'f462f_criterios'));
        // Unifica crit√©rios estruturantes da 4.6
        p.F46_CRITERIOS = [...p.F46_CRITERIOS, ...p.F462F_CRITERIOS];
        
        p.F46_PROGESTAO = getAny('F46_PROGESTAO', 'f46_progestao') || '';
        p.F46_PORTE = getAny('F46_PORTE', 'f46_porte') || '';
        p.F46_JUST_D = getAny('F46_JUST_D', 'f46_just_d') || '';
        p.F46_DOCS_D = getAny('F46_DOCS_D', 'f46_docs_d') || '';
        p.F46_JUST_E = getAny('F46_JUST_E', 'f46_just_e') || '';
        p.F46_DOCS_E = getAny('F46_DOCS_E', 'f46_docs_e') || '';
        p.F466_DOCS = getAny('F466_DOCS', 'f466_docs') || '';
        p.F466_EXEC_RES = getAny('F466_EXEC_RES', 'f466_exec_res') || '';

        // 5. Justificativas Gerais
        p.JUSTIFICATIVAS_GERAIS = getAny('JUSTIFICATIVAS_GERAIS', 'justificativas_gerais') || '';

        // 6. Data Termo
        p.data_termo = getAny('DATA_TERMO_GERADO', 'DATA_SOLIC_GERADA', 'data_termo', 'data') || '';

        return p;
      }

      function hojeBR_robusto(){
        try{
          const s = new Date().toLocaleDateString('pt-BR');
          if (s && /\d{2}\/\d{2}\/\d{4}/.test(s)) return s;
        }catch(_){}
        return '';
      }

      function normalizarEsfera(txt){
        const t = String(txt||'').toLowerCase();
        if (t.includes('estadual') || t.includes('distrit')) return '1.1.2 RPPS Estadual/Distrital';
        if (t.includes('municip')) return '1.1.1 RPPS Municipal';
        return (typeof __NA_ALL__==='function' && __NA_ALL__()) ? __NA_LABEL__() : '‚Äî';
      }

      // ========= Fun√ß√£o principal (Render) =========
      function run(payload){

        if (payload && payload.__NA_ALL) {
          console.log('TERMO: payload vazio (__NA_ALL), n√£o vou preencher nada ainda.');
          return;
        }
        // üö® TESTE 1: Payload Bruto (para checar a comunica√ß√£o)
        console.log('TERMO: RAW Payload recebido:', JSON.stringify(payload));

        // =======================================================
        // üí° CORRE√á√ÉO FASE 4.3: Converte strings de crit√©rios em arrays
        // -------------------------------------------------------
        // Esta corre√ß√£o DEVE ser aplicada ao 'payload' (a entrada)
        // antes de chamar 'normalizePayload'.

        // Lista de campos que devem ser arrays de strings
        const arrFields = [
          'F43_LISTA',
          'F43_LISTA[]',
          'F43_LISTA_TXT',
          'F43_LISTA_TXT[]',
          'F43_ITENS',
          'F43_ITENS[]',
          'F43_INCLUIR',
          'F43_INCLUIR_B'
        ];

        // Fun√ß√£o utilit√°ria para garantir Array a partir de string delimitada
        const ensureArray = (value) => {
        // Se j√° for array, retorna filtrando valores falsy
        if (Array.isArray(value)) return value.filter(Boolean);
        // Se for nulo ou vazio, retorna array vazio
        if (!value) return [];

        const s = String(value).trim();
        if (!s) return [];

        // Separa por ponto e v√≠rgula, v√≠rgula ou quebra de linha
        return s
          .split(/[;,]\s*|\r?\n/)
          .map(x => x.trim())
          .filter(Boolean);
      };

      // Aplica a convers√£o usando 'payload', que √© o objeto de entrada.
      arrFields.forEach((field) => {
        // Se o campo existir, normaliza como array de strings
        if (field in payload && payload[field] != null) {
          payload[field] = ensureArray(payload[field]);
        }
      });

        // =======================================================

        const p = normalizePayload(payload || {});
        window.__TERMO_DATA__ = Object.assign({}, window.__TERMO_DATA__ || {}, p);

        // üö® TESTE 2: Chaves F43 ap√≥s a normaliza√ß√£o (o que o script est√° vendo)
        console.log('TERMO: Normalized F43 keys:', {
            F43_LISTA: p.F43_LISTA,
            F43_INCLUIR: p.F43_INCLUIR,
            F43_INCLUIR_B: p.F43_INCLUIR_B,
            F43_PLANO: p.F43_PLANO,
            F43_PLANO_B: p.F43_PLANO_B,
            F43_DESC_PLANOS: p.F43_DESC_PLANOS,
            F43_JUST: p.F43_JUST
        });
        
        // 1) Cabe√ßalho/meta
        ['ente','uf','ug','cnpj_ente','cnpj_ug','email_ente','email_ug',
         'N_GESCON','DATA_ENC_VIA_GESCON','SEI_PROCESSO','PORTARIA_SRPC',
         'ORGAO_VINCULACAO_UG','nome_rep_ente','cargo_rep_ente','cpf_rep_ente',
         'email_rep_ente','tel_rep_ente','nome_rep_ug','cargo_rep_ug','cpf_rep_ug',
         'email_rep_ug','tel_rep_ug','data_vencimento_ultimo_crp','tipo_emissao_ult_crp'
        ].forEach(k => {
             let val = p[k] || p[k.toUpperCase()] || p[k.toLowerCase()];
             fillText(k, val);
        });
        
        // 3.4 Prazo Adicional
        (function applyPrazoAdicional(code){
          const itens = Array.from(document.querySelectorAll('[data-3_4]'));
          let mostrou = false;
          itens.forEach(el => {
            const tag = (el.getAttribute('data-3_4') || '').trim();
            const ok  = code && tag === code;
            if (ok) { el.style.display = ''; mostrou = true; }
            else { el.remove(); }
          });
          const holder = document.querySelector('[data-k="PRAZO_ADICIONAL_TEXTO"]');
          if (holder) {
            if (mostrou) holder.classList.add('d-none');
            else {
              const txt = p.PRAZO_ADICIONAL_TEXTO || 'N√£o informado';
              holder.textContent = txt;
              holder.classList.toggle('d-none', !txt.trim());
            }
          }
        })(p.PRAZO_ADICIONAL_COD);

        // 3.3 Listas
        fillList('#criterios-list', p.__CRITERIOS_ARR__);

        // 4) Fase Selecionada
        let faseSel = p.__FASE_SEL__;
        if (!faseSel) {
           // Auto-detec√ß√£o se vazio
           if (p.F41_OPCAO_TEXT) faseSel = '4.1';
           else if (p.F42_LISTA.length) faseSel = '4.2';
           else if (p.F43_LISTA.length || p.F43_INCLUIR.length || p.F43_PLANO) faseSel = '4.3';
           else if (p.F44_DECLS.length) faseSel = '4.4';
           else if (p.F45_DECLS.length) faseSel = '4.5';
           else if (p.F46_DECLS.length || p.F46_CRITERIOS.length) faseSel = '4.6';
        }

        // Oculta label "Fase selecionada:"
        const faseTxtEl = document.getElementById('fase-escolhida');
        if (faseTxtEl && faseTxtEl.parentElement) faseTxtEl.parentElement.hidden = true;

        function togglePhaseBlock(id, hasContent) {
          const el = $(id);
          if (el) {
            el.hidden = !hasContent;
            el.setAttribute('data-empty', hasContent ? 'false' : 'true');
          }
        }

        // --- FASE 4.1 ---
        togglePhaseBlock('#fase-41', !!p.F41_OPCAO_TEXT);
        const ul41 = $('#f41-itens');
        if(ul41) ul41.innerHTML = p.F41_OPCAO_TEXT ? `<li>${escapeHtml(p.F41_OPCAO_TEXT)}</li>` : '';

        // --- FASE 4.2 ---
        togglePhaseBlock('#fase-42', fillList('#f42-itens', p.F42_LISTA));


        (function run43() {
          console.group('[DEBUG FASE 4.3 - IN√çCIO]');
          
          try {
            let hasContent = false;

            // ================================================================
            // 1. LOG DOS DADOS RECEBIDOS
            // ================================================================
            console.log('DADOS BRUTOS (p - Parcial):', {
              F43_LISTA: p.F43_LISTA,
              F43_PLANO: p.F43_PLANO,
              F43_JUST: p.F43_JUST,
              F43_INCLUIR: p.F43_INCLUIR,
              F43_PLANO_B: p.F43_PLANO_B,
              F43_DESC_PLANOS: p.F43_DESC_PLANOS,
              F43_INCLUIR_B: p.F43_INCLUIR_B
            });

            // ================================================================
            // 2. TRATAMENTO DA LISTA DE CRIT√âRIOS
            // ================================================================
            const candidatosF43 = [
              p.F43_LISTA,           // principal (array j√° normalizado)
              p.f43_lista,           // min√∫sculo
              p['F43_LISTA[]'],      // varia√ß√£o com colchetes
              p['F43_ITENS[]'],      // legado do form
              p.F43_ITENS,           // outro legado
              p.F43_LISTA_TXT,       // string linearizada (com ";")
              p['F43_LISTA_TXT[]']   // se vier por algum binding diferente
            ];

            let rawList = [];
            for (const cand of candidatosF43) {
              const arr = asArr(cand);
              if (arr && arr.length) {
                rawList = arr;
                break;
              }
            }

            console.log('[Fase 4.3] Base bruta de crit√©rios (rawList):', rawList);

            // ================================================================
            // 3. Fun√ß√£o de filtro segura
            // ================================================================
            const filterList = (keywords) => {
              return rawList.filter(item => {
                const lowItem = String(item || '').toLowerCase();
                return keywords.some(k => lowItem.includes(k));
              });
            };

            // ================================================================
            // 4. Processador de sub-se√ß√µes
            //    (AGORA USANDO OS NOVOS IDs #f43-1, #f43-2, ..., #f43-9)
            // ================================================================
            const processSub = (ulId, containerId, keywords) => {
              const list = filterList(keywords);
              const preencheu = fillList(ulId, list);

              console.log(
                `[SUBITEM ${containerId}] Palavras chave: ${JSON.stringify(keywords)} | Encontrados: ${list.length}`
              );

              if (!document.querySelector(containerId)) {
                console.error(`[ERRO] Container ${containerId} n√£o encontrado no DOM.`);
              }

              show(containerId, preencheu);

              if (preencheu) {
                hasContent = true;
              }
              return preencheu;
            };

            // ================================================================
            // 5. EXECU√á√ÉO DOS SUBITENS 4.3.1 a 4.3.9
            //    (IDs DO HTML: #f43-1 ... #f43-9)
            // ================================================================
            processSub('#f43-1', '#f43-sub-1',
              ['dipr', 'car√°ter contributivo', 'repasse', 'aportes', 'parcelamento']
            );
            processSub('#f43-2', '#f43-sub-2',
              ['utiliza√ß√£o dos recursos', 'utilizacao dos recursos']
            );
            processSub('#f43-3', '#f43-sub-3',
              ['aplica√ß√µes financeiras', 'aplicacoes financeiras', 'dair', 'dpin']
            );
            processSub('#f43-4', '#f43-sub-4',
              ['limites de contribui√ß√£o', 'limites de contribuicao']
            );
            processSub('#f43-5', '#f43-sub-5',
              ['rol de benef√≠cios', 'rol de beneficios', 'plano de benef√≠cios', 'plano de beneficios']
            );
            processSub('#f43-6', '#f43-sub-6',
              ['previd√™ncia complementar', 'previdencia complementar', 'rpc']
            );
            processSub('#f43-7', '#f43-sub-7',
              ['envio dos dados', 'solicita√ß√£o de legisla√ß√£o', 'solicitacao de legislacao',
              'atendimento √† fiscaliza√ß√£o', 'atendimento a fiscalizacao', 'nta', 'draa', 'msc', 'esocial']
            );
            processSub('#f43-8', '#f43-sub-8',
              ['compensa√ß√£o previdenci√°ria', 'compensacao previdenciaria']
            );
            processSub('#f43-9', '#f43-sub-9',
              ['requisitos para os dirigentes', 'colegiados', 'art. 8¬∫-b', 'art. 8¬∫ b', '8¬∫-b']
            );

            // ================================================================
            // 6. SUBITEM 4.3.10
            // ================================================================
            const opt4310 = String(p.F4310_OPCAO || p.f4310_opcao || '').trim().toLowerCase();
            const optA = opt4310.startsWith('a');
            const optB = opt4310.startsWith('b');

            show('#f43-opcao-a', optA);
            show('#f43-opcao-b', optB);
            show('#f43-sub-10', optA || optB);

            if (optA) {
              const okA = fillBlock('#val-f4310-leg', p.F4310_LEGISLACAO);
              if (okA) hasContent = true;
            }
            if (optB) {
              const okB = fillBlock('#val-f4310-docs', p.F4310_DOCS);
              if (okB) hasContent = true;
            }

            // ================================================================
            // 7. SUBITEM 4.3.11
            // ================================================================
            const f43_plano_txt = p.F43_PLANO || p.F43_JUST || '';

            let f43_incluir_raw = p['F43_INCLUIR[]'] || p.F43_INCLUIR || [];

            const f43_incluir_list = Array.isArray(f43_incluir_raw)
              ? f43_incluir_raw.filter(Boolean)
              : String(f43_incluir_raw).split(/;|\n/).map(x => x.trim()).filter(Boolean);

            const h11_1 = fillList('#f43-crit-incluir', f43_incluir_list);
            const h11_2 = fillValue('#f43-just-11', f43_plano_txt);

            const show11 = (h11_1 || h11_2);
            show('#f43-sub-11', show11);
            if (show11) hasContent = true;

            // ================================================================
            // 8. SUBITEM 4.3.12
            // ================================================================
            const f43_plano_b_txt = p.F43_PLANO_B || '';
            const f43_desc_txt = p.F43_DESC_PLANOS || '';

            let f43_incluir_b_raw = p['F43_INCLUIR_B[]'] || p.F43_INCLUIR_B || [];

            const f43_incluir_b_list = Array.isArray(f43_incluir_b_raw)
              ? f43_incluir_b_raw.filter(Boolean)
              : String(f43_incluir_b_raw).split(/;|\n/).map(x => x.trim()).filter(Boolean);

            const h12_1 = fillList('#f43-crit-incluir-12', f43_incluir_b_list);
            const h12_2 = fillValue('#f43-just-12', f43_plano_b_txt);
            const h12_3 = fillValue('#f43-desc-planos-12', f43_desc_txt);

            const show12 = (h12_1 || h12_2 || h12_3);
            show('#f43-sub-12', show12);
            if (show12) hasContent = true;

            // ================================================================
            // 9. CONTROLE FINAL DO BLOCO
            // ================================================================
            console.log('-> FASE 4.3 TEM CONTE√öDO FINAL?', hasContent);
            togglePhaseBlock('#fase-43', hasContent);

          } catch (e) {
            console.error('ERRO FATAL NA FASE 4.3:', e);
            const errEl = document.getElementById('fase-43');
            if (errEl) {
              errEl.hidden = false;
              errEl.style.display = 'block';
              errEl.innerHTML = `
                <div style="color:red; border:1px solid red; padding:10px;">
                  ERRO GRAVE NA FASE 4.3: ${e.message}.  
                  Veja o console para detalhes.
                </div>`;
            }
          }

          console.groupEnd();
        })();


        // 5) Justificativas Gerais
        fillText('justificativas_gerais', p.JUSTIFICATIVAS_GERAIS);
        
        // 6) Data e Assinaturas
        let dataTermo = p.data_termo || hojeBR_robusto();
        fillText('data_termo', dataTermo);

        // 7) Esfera
        const esferaTxt = normalizarEsfera(p.ESFERA);
        const esferaNode = document.querySelector('[data-esfera]');
        if (esferaNode) esferaNode.textContent = esferaTxt;
        (function(){
          const sig = document.getElementById('sig-cap-ente');
          if (sig) {
            const isEstDistr = /Estadual\/Distrital/i.test(esferaTxt);
            sig.innerHTML = isEstDistr
              ? 'Representante legal do Estado/Distrito de <span data-k="ente"></span>/<span data-k="uf"></span>'
              : 'Representante legal do Munic√≠pio de <span data-k="ente"></span>/<span data-k="uf"></span>';
            fillText('ente', p.ENTE); fillText('uf', p.UF);
          }
        })();

        // Flag de pronto para Puppeteer
        if (!window.__TERMO_READY_FIRED__) {
            window.__TERMO_READY_FIRED__ = true;
            requestAnimationFrame(() => {
                document.documentElement.setAttribute('data-termo-ready','1');
                window.__TERMO_PRINT_READY__ = true;
                try { document.dispatchEvent(new CustomEvent('TERMO_PRINT_READY')); } catch {}
            });
        }
      }

      // Exposi√ß√£o global
      window.run = run;
      window.__TERMO_RUN__ = run;

      // Inicializa√ß√£o
      if (window.__TERMO_DATA__) { 
          try { run(window.__TERMO_DATA__); } catch {} 
      }
      document.addEventListener('TERMO_DATA_READY', () => { try { run(window.__TERMO_DATA__ || {}); } catch {} });
      document.addEventListener('TERMO_DATA',       () => { try { run(window.__TERMO_DATA__ || {}); } catch {} });
      
      // Fallback
      setTimeout(() => {
         if (!window.__TERMO_READY_FIRED__) {
             run(window.__TERMO_DATA__ || {__NA_ALL:true});
         }
      }, 800);
    })();
  </script>
</body>
</html>