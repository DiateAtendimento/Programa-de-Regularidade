<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Termo de Solicitação de CRP Emergencial</title>

  <!-- Fonte apenas para PREVIEW em tela -->
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap"
        rel="stylesheet" media="screen">

  <!-- Estilos oficiais do termo (usa Rawline no PDF) -->
  <link rel="stylesheet" href="./termo_solic_crp.css">
</head>

<body>
  <div id="pdf-root">
    <main class="term-wrap">
      <header class="page-head">
        <div class="logos-wrap">
          <img src="./imagens/logo-secretaria-complementar.svg" alt="Secretaria" loading="eager" />
          <img src="./imagens/logo-termo-drpps.svg" alt="Departamento de RPPS" loading="eager" />
        </div>
      </header>
      <h1 class="term-title"><br>TERMO DE SOLICITAÇÃO DE CRP EMERGENCIAL<br>PROGRAMA DE REGULARIDADE PREVIDENCIÁRIA<br></h1>

      <p class="term-meta">
        Ente: <strong data-k="ente"></strong> / UF: <strong data-k="uf"></strong> • UG: <strong data-k="ug"></strong>
      </p>
      <!-- 1. IDENTIFICAÇÃO -->
      <section class="term-section avoid-break">
        <!-- (3) REFERÊNCIA NORMATIVA ATUALIZADA -->
        <p class="term-intro small" style="margin-top:4mm; text-align:justify;">
          O Regime Próprio de Previdência Social (RPPS) abaixo especificado requer a emissão de Certificado de Regularidade Previdenciária,
          na forma emergencial, para execução do Programa de Regularidade Previdenciária dos Regimes Próprios de Previdência Social,
          instituído pelo Ministério da Previdência Social, conforme a <strong>Portaria SRPC/MPS nº <span data-k="PORTARIA_SRPC">—</span></strong>
          e o previsto no Anexo XVIII da Portaria MTP nº 1.467, de 2 de junho de 2022.
        </p><br>

        <!-- (1) RÓTULO AJUSTADO -->
        <div class="gescon-breadcrumb small">
          <span><strong>Enviado via Consulta GESCON:</strong> <span class="text-body" data-k="N_GESCON">—</span></span>
          <span class="sep">–</span>
          <span><strong>Data do encaminhamento:</strong> <span class="text-body" data-k="DATA_ENC_VIA_GESCON">—</span></span>
        </div>

        <!-- SEI no cabeçalho -->
        <div class="gescon-breadcrumb small">
          <span><strong>Nº Processo SEI (Pró-Regularidade):</strong>
            <span class="text-body" data-k="SEI_PROCESSO">—</span>
          </span>
        </div>

        <h2><br>1. IDENTIFICAÇÃO DO ENTE FEDERATIVO E DA UNIDADE GESTORA</h2>
        <h3><span class="label">1.1 Esfera de Governo</span></h3>
        <ul id="opt-1-1">
          <li data-code="1.1.1">1.1.1 RPPS Municipal</li>
          <li data-code="1.1.2">1.1.2 Estadual/Distrital</li>
        </ul>

        <h3><strong>1.2 Ente Federativo</strong></h3>
        <div class="grid grid-num">
          <div class="field"><span class="label"><strong>1.2.1 Ente</strong></span><span class="value" data-k="ente"></span></div>
          <div class="field"><span class="label"><strong>1.2.2 CNPJ</strong></span><span class="value" data-k="cnpj_ente"></span></div>
          <div class="field"><span class="label"><strong>1.2.3 E-mail oficial</strong></span><span class="value" data-k="email_ente"></span></div>
        </div>

        <h3><strong>1.3 Regime Próprio de Previdência Social (RPPS)</strong></h3>
        <div class="grid grid-num">
          <div class="field"><span class="label"><strong>1.3.1 Unidade Gestora</strong></span><span class="value" data-k="ug"></span></div>
          <div class="field"><span class="label"><strong>1.3.2 CNPJ</strong></span><span class="value" data-k="cnpj_ug"></span></div>
          <div class="field"><span class="label"><strong>1.3.3 E-mail oficial</strong></span><span class="value" data-k="email_ug"></span></div>
        </div>
      </section>
      <!-- 2. IDENTIFICAÇÃO DOS RESPONSÁVEIS -->
      <section class="term-section avoid-break">
        <h2>2. IDENTIFICAÇÃO DOS RESPONSÁVEIS</h2>

        <h3><strong>2.1 Representante legal do ente federativo</strong></h3>
        <div class="grid grid-num">
          <div class="field"><span class="label"><strong>2.1.1 Nome</strong></span><span class="value" data-k="nome_rep_ente"></span></div>
          <div class="field"><span class="label"><strong>2.1.2 Cargo/Função</strong></span><span class="value" data-k="cargo_rep_ente"></span></div>
          <div class="field"><span class="label"><strong>2.1.3 CPF</strong></span><span class="value" data-k="cpf_rep_ente"></span></div>
          <div class="field"><span class="label"><strong>2.1.4 E-mail</strong></span><span class="value" data-k="email_rep_ente"></span></div>
          <div class="field"><span class="label"><strong>2.1.5 Telefone</strong></span><span class="value" data-k="tel_rep_ente"></span></div>
        </div>

        <h3>2.2 Representante legal do RPPS</h3>
        <div class="grid grid-num">
          <div class="field"><span class="label"><strong>2.2.1 Nome</strong></span><span class="value" data-k="nome_rep_ug"></span></div>
          <div class="field"><span class="label"><strong>2.2.2 Cargo/Função</strong></span><span class="value" data-k="cargo_rep_ug"></span></div>
          <div class="field"><span class="label"><strong>2.2.3 CPF</strong></span><span class="value" data-k="cpf_rep_ug"></span></div>
          <div class="field"><span class="label"><strong>2.2.4 E-mail</strong></span><span class="value" data-k="email_rep_ug"></span></div>
          <div class="field"><span class="label"><strong>2.2.5 Telefone</strong></span><span class="value" data-k="tel_rep_ug"></span></div>
        </div>
      </section>
      <!-- 3. SITUAÇÃO RELATIVA AO CRP -->
      <section class="term-section avoid-break">
        <h2>3. SITUAÇÃO RELATIVA AO CERTIFICADO DE REGULARIDADE PREVIDENCIÁRIA (CRP)</h2>

        <div class="grid grid-num">
          <div class="field"><span class="label"><strong>3.1 Data de vencimento do último CRP</strong></span><span class="value" data-k="venc_ult_crp"></span></div>
        </div>

        <!-- 3.2 — motivo do prazo adicional (seleção única) -->
        <h3>3.2 Motivo principal do pedido de prazo adicional</h3>
        <p class="small">Será exibida apenas a alternativa selecionada no formulário.</p>
        <ul id="opt-3-2">
          <li data-code="3.2.1"><strong>3.2.1 Manutenção da conformidade</strong></li>
          <li data-code="3.2.2"><strong>3.2.2 Equacionamento do déficit atuarial (ou necessidade de prazo adicional para implementar)</strong></li>
          <li data-code="3.2.3"><strong>3.2.3 Organização do RPPS conforme critérios estruturantes (inclui art. 40, § 20, CF)</strong></li>
          <li data-code="3.2.4"><strong>3.2.4 Outro critério que apresente (ou possa apresentar) maior complexidade</strong></li>
        </ul>

        <h3>3.3 Critério(s) irregular(es) no extrato previdenciário</h3>
        <ul id="criterios-list"></ul>
      </section>
      <!-- 4. FASE DO PROGRAMA -->
      <section class="term-section">
        <h2>4. IDENTIFICAÇÃO DA FASE DO PROGRAMA DE REGULARIDADE PREVIDENCIÁRIA</h2>
        <p class="small">Fase selecionada: <strong data-k="fase_programa"></strong></p>

        <!-- 4.1 -->
        <div class="avoid-break" id="fase-41" hidden>
          <h3>4.1 Fase Geral/Introdutória – 1º CRP Emergencial</h3>
          <ul id="f41-itens"></ul>
        </div>

        <!-- 4.2 -->
        <div class="avoid-break" id="fase-42" hidden>
          <h3>4.2 Fase Geral/Introdutória – 2º CRP Emergencial</h3>
          <p class="small">Condições declaradas:</p>
          <ul id="f42-itens"></ul>
        </div>

        <!-- 4.3 -->
        <div class="avoid-break" id="fase-43" hidden>
          <h3>4.3 Fase Intermediária/Preparatória – 3º CRP Emergencial</h3>
          <ul id="f43-itens"></ul>
          <p class="small mt"><strong>4.3.10 Justificativas/Informações adicionais:</strong></p>
          <p data-k="f43_just"></p>
          <p class="small mt"><strong>4.3.11 Inclusões sugeridas nos Planos de Ação da Fase Específica:</strong></p>
          <p data-k="f43_plano"></p>
        </div>
        <!-- 4.4 -->
        <div class="avoid-break" id="fase-44" hidden>
          <h3>4.4 Fase Específica/Focalizada – 4º CRP Emergencial</h3>
          <p class="small"><strong>4.4.1 Critério(s) do extrato objeto do(s) Plano(s) de Ação:</strong></p>
          <ul id="f44-criterios"></ul>

          <p class="small mt"><strong>4.4.2 Declarações:</strong></p>
          <ul id="f44-decls"></ul>

          <p class="small mt"><strong>4.4.3 Finalidade do(s) Plano(s) de Ação:</strong></p>
          <ul id="f44-finalidades"></ul>

          <p class="small mt"><strong>4.4.4 Anexos:</strong></p>
          <div id="f44-anexos"></div>
        </div>

        <!-- 4.5 -->
        <div class="avoid-break" id="fase-45" hidden>
          <h3>4.5 Fase Específica/Focalizada – 5º CRP Emergencial</h3>
          <ul id="f45-decls"></ul>
          <p class="small mt"><strong>4.5.2/4.5.3 Documentos:</strong></p>
          <div id="f45-docs"></div>
          <p class="small mt"><strong>4.5.4 Justificativas:</strong></p>
          <div id="f45-just"></div>
        </div>

        <!-- 4.6 -->
        <div class="avoid-break" id="fase-46" hidden>
          <h3>4.6 Fase de Manutenção da Conformidade</h3>
          <p class="small"><strong>4.6.1 Critério(s) objeto do(s) Plano(s) de Ação:</strong></p>
          <ul id="f46-criterios"></ul>

          <p class="small mt"><strong>4.6.2 Declarações e informações:</strong></p>
          <ul id="f46-decls"></ul>

          <p class="small mt"><strong>4.6.3 Finalidade do(s) Plano(s) de Ação:</strong></p>
          <ul id="f46-finalidades"></ul>

          <p class="small mt"><strong>4.6.4 Anexos:</strong></p>
          <div id="f46-anexos"></div>

          <p class="small mt"><strong>4.6.5 Justificativas quanto ao(s) Plano(s) de Ação:</strong></p>
          <div id="f46-just-planos"></div>

          <p class="small mt"><strong>4.6.6 Comprovação do cumprimento do(s) Plano(s):</strong></p>
          <div id="f46-comp-cumpr"></div>
        </div>
      </section>
      <!-- 5. JUSTIFICATIVAS GERAIS -->
      <section class="term-section">
        <h2>5. JUSTIFICATIVAS / INFORMAÇÕES ADICIONAIS</h2>
        <p data-k="justificativas_gerais"></p>
      </section>

      <!-- Assinaturas -->
      <footer class="term-footer">
        <p class="place-date"><span data-k="ente"></span>/<span data-k="uf"></span>, <span data-k="data_termo"></span>.</p>

        <div class="signature-block">
          <div class="signature-line" aria-hidden="true"></div>
          <p class="signature-caption">
            <strong><span data-k="nome_rep_ente"></span></strong><br>
            <span id="sig-cap-ente">Representante legal do Município de <span data-k="ente"></span>/<span data-k="uf"></span></span>
          </p>
        </div>

        <div class="signature-block">
          <div class="signature-line" aria-hidden="true"></div>
          <p class="signature-caption">
            <strong><span data-k="nome_rep_ug"></span></strong><br>
            Representante legal do <span data-k="ug"></span>
          </p>
        </div>
      </footer>
    </main>
  </div>
<script>
  (function(){
  const $  = (s, r=document)=>r.querySelector(s);
  const $$ = (s, r=document)=>Array.from(r.querySelectorAll(s));

  function fillText(key, val){
    $$( '[data-k="'+key+'"]' ).forEach(el => { el.textContent = (val ?? ''); });
  }

  function escapeHtml(s){
    return String(s||'').replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'})[m]);
  }
  function liList(ulSel, items){
    const ul = $(ulSel); if (!ul) return;
    ul.innerHTML = (items||[]).filter(Boolean).map(t => '<li>'+escapeHtml(t)+'</li>').join('');
  }
  function selectByCode(listSel, code){
    if(!code) return;
    const ul = $(listSel); if(!ul) return;
    const node = ul.querySelector('[data-code="'+code+'"]');
    if (node) node.innerHTML = '<strong>'+node.textContent+'</strong>';
  }
  function show(id, v){ const el = $('#'+id); if (el) el.hidden = !v; }
  function splitLines(s){ return String(s||'').split(/\r?\n/).map(t=>t.trim()).filter(Boolean); }
  const asArr = v => Array.isArray(v) ? v : String(v||'').split(',').map(s=>s.trim()).filter(Boolean);

  function run(payload){
    const p = payload || {};

    /* ===== 1) Cabeçalho/meta ===== */
    fillText('ente', p.ENTE || p.ente);
    fillText('uf', p.UF || p.uf);
    fillText('ug', p.UG || p.ug);
    fillText('cnpj_ente', p.CNPJ_ENTE || p.cnpj_ente);
    fillText('cnpj_ug', p.CNPJ_UG || p.cnpj_ug);
    fillText('email_ente', p.EMAIL_ENTE || p.email_ente);
    fillText('email_ug', p.EMAIL_UG || p.email_ug);
    fillText('N_GESCON', p.N_GESCON || p.n_gescon || '');
    fillText('DATA_ENC_VIA_GESCON', p.DATA_ENC_VIA_GESCON || p.data_enc_via_gescon || '');
    fillText('SEI_PROCESSO', p.SEI_PROCESSO || p.sei_processo || '');
    fillText('PORTARIA_SRPC', p.PORTARIA_SRPC || p.portaria_srpc || p.PORTARIA_SRPC_MPS || '');

    /* ===== 2) Responsáveis ===== */
    fillText('nome_rep_ente',  p.NOME_REP_ENTE || p.nome_rep_ente);
    fillText('cargo_rep_ente', p.CARGO_REP_ENTE || p.cargo_rep_ente);
    fillText('cpf_rep_ente',   p.CPF_REP_ENTE || p.cpf_rep_ente);
    fillText('email_rep_ente', p.EMAIL_REP_ENTE || p.email_rep_ente);
    fillText('tel_rep_ente',   p.TEL_REP_ENTE || p.tel_rep_ente);

    fillText('nome_rep_ug',  p.NOME_REP_UG || p.nome_rep_ug);
    fillText('cargo_rep_ug', p.CARGO_REP_UG || p.cargo_rep_ug);
    fillText('cpf_rep_ug',   p.CPF_REP_UG || p.cpf_rep_ug);
    fillText('email_rep_ug', p.EMAIL_REP_UG || p.email_rep_ug);
    fillText('tel_rep_ug',   p.TEL_REP_UG || p.tel_rep_ug);

    /* ===== 3) CRP ===== */
    fillText('venc_ult_crp', p.DATA_VENCIMENTO_ULTIMO_CRP || p.venc_ult_crp || '');

    // 3.2 — motivo principal (dedução se não vier OPT_3_2)
    (function(){
      let code = (p.OPT_3_2 || p.opt_3_2 || '').trim();
      if (!code) {
        const yes = v => String(v||'').toUpperCase() === 'SIM';
        if (yes(p.FIN_3_2_MANUTENCAO_CONFORMIDADE)) code = '3.2.1';
        else if (yes(p.FIN_3_2_DEFICIT_ATUARIAL))    code = '3.2.2';
        else if (yes(p.FIN_3_2_CRITERIOS_ESTRUTURANTES)) code = '3.2.3';
        else if (yes(p.FIN_3_2_OUTRO_CRITERIO_COMPLEXO)) code = '3.2.4';
      }
      const ul = document.querySelector('#opt-3-2');
      if (!ul || !code) return;
      [...ul.children].forEach(li => {
        if (li.getAttribute('data-code') !== code) li.remove();
      });
    })();

    // 3.3 — critérios
    const criterios = Array.isArray(p.CRITERIOS_IRREGULARES)
      ? p.CRITERIOS_IRREGULARES
      : String(p.CRITERIOS_IRREGULARES || '').split(',').map(s=>s.trim()).filter(Boolean);
    liList('#criterios-list', criterios);

    /* ===== 4) Fase ===== */
    const faseSel = (p.FASE_PROGRAMA || p.fase_programa || '').trim();
    fillText('fase_programa', faseSel || '—');

    function showOnlyPhase(code){
      const ids = { '4.1':'fase-41', '4.2':'fase-42', '4.3':'fase-43', '4.4':'fase-44', '4.5':'fase-45', '4.6':'fase-46' };
      Object.values(ids).forEach(id => show(id, false));
      if (ids[code]) show(ids[code], true);
    }
    showOnlyPhase(faseSel);

    switch (faseSel) {
      case '4.1': {
        const it = [];
        const v = String(p.F41_OPCAO||'').toLowerCase();
        if (/^4\.1\.1/.test(p.F41_OPCAO) || /incluiu|incluidos|incluídos/.test(v)) it.push('4.1.1 Incluiu todos os débitos (Cadprev).');
        else if (/^4\.1\.2/.test(p.F41_OPCAO) || /não possui|nao possui|regularizad/.test(v)) it.push('4.1.2 Não possui débitos ou já regularizados.');
        liList('#f41-itens', it);
        break;
      }
      case '4.2': liList('#f42-itens', asArr(p.F42_LISTA)); break;
      case '4.3': {
        liList('#f43-itens', asArr(p.F43_LISTA));
        fillText('f43_just',  p.F43_JUST  || '');
        fillText('f43_plano', p.F43_PLANO || '');
        break;
      }
      case '4.4': {
        liList('#f44-criterios',   asArr(p.F44_CRITERIOS));
        liList('#f44-decls',       asArr(p.F44_DECLS));
        liList('#f44-finalidades', asArr(p.F44_FINALIDADES));
        const ax = splitLines(p.F44_ANEXOS || '');
        const box = document.querySelector('#f44-anexos');
        if (box) box.innerHTML = ax.length ? '<ul>'+ax.map(a=>'<li>'+escapeHtml(a)+'</li>').join('')+'</ul>' : '—';
        break;
      }
      case '4.5': {
        const decls = p.F45_OK451 ? ['4.5.1 Mantida a regularidade das fases anteriores.'] : [];
        liList('#f45-decls', decls);
        const d = splitLines(p.F45_DOCS || '');
        const j = splitLines(p.F45_JUST || '');
        const docsBox = document.querySelector('#f45-docs');
        const justBox = document.querySelector('#f45-just');
        if (docsBox) docsBox.innerHTML = d.length ? '<ul>'+d.map(a=>'<li>'+escapeHtml(a)+'</li>').join('')+'</ul>' : '—';
        if (justBox) justBox.innerHTML = j.length ? '<ul>'+j.map(a=>'<li>'+escapeHtml(a)+'</li>').join('')+'</ul>' : '—';
        break;
      }
      case '4.6': {
        liList('#f46-criterios',   asArr(p.F46_CRITERIOS));
        const decls = [];
        if (Array.isArray(p.F46_DECLS)) decls.push(...p.F46_DECLS);
        if (p.F46_PROGESTAO) decls.push('Nível Pró-Gestão RPPS: ' + p.F46_PROGESTAO);
        if (p.F46_PORTE)     decls.push('Grupo de Porte (ISP-RPPS): ' + p.F46_PORTE);
        if (p.F46_JUST_D)    decls.push('(d) Justificativas: ' + p.F46_JUST_D);
        if (p.F46_DOCS_D)    decls.push('(d) Documentos: ' + p.F46_DOCS_D);
        if (p.F46_JUST_E)    decls.push('(e) Justificativas: ' + p.F46_JUST_E);
        if (p.F46_DOCS_E)    decls.push('(e) Documentos: ' + p.F46_DOCS_E);
        liList('#f46-decls', decls);
        liList('#f46-finalidades', asArr(p.F46_FINALIDADES));
        const ax = splitLines(p.F46_ANEXOS || '');
        const axBox = document.querySelector('#f46-anexos');
        if (axBox) axBox.innerHTML = ax.length ? '<ul>'+ax.map(a=>'<li>'+escapeHtml(a)+'</li>').join('')+'</ul>' : '—';
        const jp = document.getElementById('f46-just-planos');
        const cc = document.getElementById('f46-comp-cumpr');
        if (jp) jp.textContent = p.F46_JUST_PLANOS || '—';
        if (cc) cc.textContent = p.F46_COMP_CUMPR || '—';
        break;
      }
    }

    /* ===== 5) Justificativas gerais ===== */
    fillText('justificativas_gerais', p.JUSTIFICATIVAS_GERAIS || '');

    /* ===== 6) Assinaturas (data) ===== */
    const hoje = p.DATA_TERMO_GERADO || p.DATA || p.DATA_SOLIC_GERADA || '';
    fillText('data_termo', hoje);

    /* ===== 1.1 Esfera + legenda de assinatura ===== */
    const esfera = p.ESFERA || p.ESFERA_GOVERNO || p.ESFERA_SUGERIDA || '';
    selectByCode('#opt-1-1', /estadual|distrital/i.test(esfera) ? '1.1.2' : '1.1.1');
    (function(){
      const sig = document.getElementById('sig-cap-ente');
      if (sig) {
        sig.innerHTML = (/estadual|distrit/i.test(esfera))
          ? 'Representante legal do Estado/Distrito de <span data-k="ente"></span>/<span data-k="uf"></span>'
          : 'Representante legal do Município de <span data-k="ente"></span>/<span data-k="uf"></span>';
      }
    })();

    /* ===== Sinaliza pronto ao Puppeteer ===== */
    try{
      if (!window.__TERMO_READY_FIRED__) {
        window.__TERMO_READY_FIRED__ = true;
        const fontsReady = (document.fonts && document.fonts.ready) ? document.fonts.ready : Promise.resolve();
        const maxWait = new Promise(r => setTimeout(r, 1500));
        Promise.race([fontsReady, maxWait]).finally(() => {
          requestAnimationFrame(() => {
            window.__TERMO_PRINT_READY__ = true;
            document.dispatchEvent(new CustomEvent('TERMO_PRINT_READY'));
          });
        });
      }
    }catch(_){}
  }

  // Bootstrap robusto
  window.__TERMO_RUN__ = run;
  if (window.__TERMO_DATA__) { try { run(window.__TERMO_DATA__); } catch {} }
  document.addEventListener('TERMO_DATA_READY', () => { try { run(window.__TERMO_DATA__ || {}); } catch {} });
  document.addEventListener('TERMO_DATA',       () => { try { run(window.__TERMO_DATA__ || {}); } catch {} });
  window.addEventListener('message', (ev) => {
    const d = ev && ev.data;
    if (d && (d.type === 'TERMO_DATA' || d.type === 'TERMO_DATA_READY')) {
      try { run(d.payload || {}); } catch {}
    }
  });
  (function spinWait(maxMs=4000, step=120){
    const t0 = Date.now();
    const iv = setInterval(() => {
      if (window.__TERMO_DATA__) {
        try { run(window.__TERMO_DATA__); } catch {}
        clearInterval(iv);
      } else if (Date.now() - t0 > maxMs) {
        clearInterval(iv);
      }
    }, step);
  })();
})();
</script>



</body>
</html>
